/*! jepun 2018-03-29 */
$(document).ready(function(){function a(a,c,d,e,f){var h={};h.url=jCom.urlPath("BackHoldingWeightOutSide/GetHoldingWeightOutSideAllT0"),h.reload=!0,h.QryStartDate=a,h.QryEndDate=c,h.QryType=d,h.QryStatus=e,h.HoldingWeightOutSideNo=f,$.when(g.addSelect("HoldingWeightOutSideNo",h)).then(function(){""!==GlbEnv.args.upcoming&&(g.getCtrl("HoldingWeightOutSideNo").filterSelect("-1",!0),$("#"+GlbEnv.args.upcoming+"Count").html(g.getCtrl("HoldingWeightOutSideNo").find("option").length)),0===f?g.getCtrl("HoldingWeightOutSideNo")[0].selectedIndex=0:g.getCtrl("HoldingWeightOutSideNo").val(f),b(g.getCtrl("HoldingWeightOutSideNo").val())})}function b(a){g.getCtrl("BtnIns2,BtnUpd2,BtnDel2,BtnIns3,BtnUpd3,BtnDel3,BtnUpd,BtnDel,BtnCopy,NextFlow,BtnFlow").addClass("hidden"),null!==a&&void 0!==a&&(g.callDataBus("BackHoldingWeightOutSide/GetHoldingWeightOutSideT1",{HoldingWeightOutSideNo:a}),c(a,0),e(a,0))}function c(a,b){var c={};c.url=jCom.urlPath("BackHoldingWeightOutSide/GetHoldingWeightOutSideFundAllT3"),c.HoldingWeightOutSideNo=a,c.Num=b,c.reload=!0,$.when(g.addSelect("HoldingWeightOutSideFund",c)).then(function(){0===b?g.getCtrl("HoldingWeightOutSideFund")[0].selectedIndex=0:g.getCtrl("HoldingWeightOutSideFund").val(b),d(g.getCtrl("HoldingWeightOutSideNo").val(),g.getCtrl("HoldingWeightOutSideFund").val())})}function d(a,b){null!==a&&void 0!==a&&null!==b&&void 0!==b&&g.callDataBus("BackHoldingWeightOutSide/GetHoldingWeightOutSideFundT4",{HoldingWeightOutSideNo:a,Num:b})}function e(a,b){var c={};c.url=jCom.urlPath("BackHoldingWeightOutSide/GetHoldingWeightOutSideFundAllT5"),c.HoldingWeightOutSideNo=a,c.Num=b,c.reload=!0,$.when(g.addSelect("HoldingWeightOutSideFund2",c)).then(function(){0===b?g.getCtrl("HoldingWeightOutSideFund2")[0].selectedIndex=0:g.getCtrl("HoldingWeightOutSideFund2").val(b),f(g.getCtrl("HoldingWeightOutSideNo").val(),g.getCtrl("HoldingWeightOutSideFund2").val())})}function f(a,b){null!==a&&void 0!==a&&null!==b&&void 0!==b&&g.callDataBus("BackHoldingWeightOutSide/GetHoldingWeightOutSideFundT6",{HoldingWeightOutSideNo:a,Num:b})}var g=$("#FormBackHoldingWeightOutSide").comm();g.addHandler("Ini",function(b){jFun.client.isMobile?g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").prop("type","date"):(g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").prop("type","text").addClass("dpDate"),g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").datepicker({dateFormat:"yy/mm/dd",firstDay:0,changeYear:!0,changeMonth:!0,yearRange:"1900:2030"})),$.when(g.addSelect("QryStatus",jFun.getOptionsUrl("Status",1,"",!1)),g.addSelect("QryType",jFun.getOptionsUrl("Type",1,"",!1)),g.addSelect("AID",jFun.getProductOutSideOptionsT3()),g.addSelect("IndType,IndType2",jFun.getOptionsUrl("IndType",1,""))).then(function(){g.getCtrl("QryStatus")[0].selectedIndex=1,""!==GlbEnv.args.upcoming?(g.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)})}),g.addHandler("BtnCopy",function(b){a(null,null,null,null,b.HoldingWeightOutSideNo)}),g.addHandler("BtnIns",function(b){a(null,null,null,null,b.HoldingWeightOutSideNo)}),g.addHandler("BtnUpd",function(b){a(null,null,null,null,g.getCtrl("HoldingWeightOutSideNo").val())}),g.addHandler("BtnDel",function(b){a(null,null,null,null,0)}),g.addHandler("BtnInsFund",function(a){c(g.getCtrl("HoldingWeightOutSideNo").val(),a.Num)}),g.addHandler("BtnUpdFund",function(a){c(g.getCtrl("HoldingWeightOutSideNo").val(),a.Num)}),g.addHandler("BtnDelFund",function(a){c(g.getCtrl("HoldingWeightOutSideNo").val(),0)}),g.addHandler("BtnInsFund2",function(a){e(g.getCtrl("HoldingWeightOutSideNo").val(),a.Num)}),g.addHandler("BtnUpdFund2",function(a){e(g.getCtrl("HoldingWeightOutSideNo").val(),a.Num)}),g.addHandler("BtnDelFund2",function(a){e(g.getCtrl("HoldingWeightOutSideNo").val(),0)}),g.addHandler("GetHoldingWeightOutSideT1",function(a){var b=$.parseJSON(a.obj);""!==GlbEnv.args.upcoming?$.when(g.addSelect("Fund",jFun.getProductOutSideOptionsT4(b[0].AID))).then(function(){$.when(initButton(g,a.obj,"HoldingWeightOutSideNo")).then(function(){g.getCtrl("BtnCopy").hide()})}):$.when(g.addSelect("Fund",jFun.getProductOutSideOptionsT4(b[0].AID))).then(function(){initButton(g,a.obj,"HoldingWeightOutSideNo")})}),g.addHandler("GetHoldingWeightOutSideFundT4",function(a){var b=$.parseJSON(a.obj);b.length>0&&g.formInject(b[0])}),g.addHandler("GetHoldingWeightOutSideFundT6",function(a){var b=$.parseJSON(a.obj);b.length>0&&g.formInject(b[0])}),g.addHandler("NextFlow",function(b){""!==GlbEnv.args.upcoming?(g.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)}),g.getCtrl("AID").on("change",function(){var a=$(this),b=jFun.getProductOutSideOptionsT4(a.val());b.reload=!0,g.addSelect("Fund",b)}),g.getCtrl("HoldingWeightOutSideNo").on("click",function(a){a.preventDefault();var c=$(this);b(c.val()),g.getCtrl("IndType,IndType2").val("-1"),g.getCtrl("Name").val(""),g.getCtrl("Weight,Weight2").val("0")}),g.getCtrl("QryFlow").on("click",function(a){a.preventDefault(),GlbAppModal.openModal("歷史流程","BackFlowDetail",{Type:20,Rno:g.getCtrl("HoldingWeightOutSideNo").val()})}),g.getCtrl("HoldingWeightOutSideFund").on("click",function(a){a.preventDefault();var b=$(this),c=g.getCtrl("HoldingWeightOutSideNo").val();d(c,b.val())}),g.getCtrl("HoldingWeightOutSideFund2").on("click",function(a){a.preventDefault();var b=$(this),c=g.getCtrl("HoldingWeightOutSideNo").val();f(c,b.val())}),g.getCtrl("BtnCopy").on("click",function(a){if(a.preventDefault(),g.valid()){var b=g.getCtrl("Fund").val(),c=b.split("@@")[1],d=b.split("@@")[2];g.getCtrl("CID").val(c),g.getCtrl("FID").val(d),g.callDataBus("BackHoldingWeightOutSide/Copy",g.formToJSON())}}),g.getCtrl("BtnIns").on("click",function(a){if(a.preventDefault(),g.valid()){var b=g.getCtrl("Fund").val(),c=b.split("@@")[1],d=b.split("@@")[2];g.getCtrl("CID").val(c),g.getCtrl("FID").val(d),g.callDataBus("BackHoldingWeightOutSide/Ins",g.formToJSON())}}),g.getCtrl("BtnUpd").on("click",function(a){a.preventDefault();var b=g.formBeforeJSON(),c=g.getCtrl("Fund").val(),d=c.split("@@")[1],e=c.split("@@")[2];g.getCtrl("CID").val(d),g.getCtrl("FID").val(e),g.callDataBus("BackHoldingWeightOutSide/Upd",{model:g.formToJSON(b,!1),Oldmodel:g.formBeforeJSON()})}),g.getCtrl("BtnDel").on("click",function(a){a.preventDefault(),g.callDataBus("BackHoldingWeightOutSide/Del",{HoldingWeightOutSideNo:g.getCtrl("HoldingWeightOutSideNo").val(),NextType:"0",NextStatus:"7",Note:"",LogSN:g.getCtrl("LogSN").val()})}),g.getCtrl("BtnQry").on("click",function(b){b.preventDefault();var c=g.getCtrl("QryStartDate").val(),d=g.getCtrl("QryEndDate").val(),e=g.getCtrl("QryType").val(),f=g.getCtrl("QryStatus").val();a(c,d,e,f,0),g.getCtrl("HoldingWeightOutSideFund").html("")}),g.getCtrl("BtnIns2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideNo").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個基金!!"):null===g.getCtrl("Name,WeightOutSide").val()||void 0===g.getCtrl("Name,WeightOutSide").val()||"-1"===g.getCtrl("IndType").val()?void jCom.Alert("提醒","請輸入有效的值"):void g.callDataBus("BackHoldingWeightOutSide/InsFund",g.formToJSON())}),g.getCtrl("BtnUpd2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideFund").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個據點!!"):void g.callDataBus("BackHoldingWeightOutSide/UpdFund",g.formToJSON())}),g.getCtrl("BtnDel2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideNo").val(),c=g.getCtrl("HoldingWeightOutSideFund").val();return null===b||void 0===b||null===c||void 0===c?void jCom.Alert("提醒","請選一個公司名稱!!"):void g.callDataBus("BackHoldingWeightOutSide/DelFund",{HoldingWeightOutSideNo:b,Num:c,LogSN:g.getCtrl("LogSN2").val()})}),g.getCtrl("BtnIns3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideNo").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個基金!!"):null===g.getCtrl("Weight2").val()||void 0===g.getCtrl("Weight2").val()||"-1"===g.getCtrl("IndType2").val()?void jCom.Alert("提醒","請輸入有效的值"):void g.callDataBus("BackHoldingWeightOutSide/InsFund2",g.formToJSON())}),g.getCtrl("BtnUpd3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideFund2").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個據點!!"):void g.callDataBus("BackHoldingWeightOutSide/UpdFund2",g.formToJSON())}),g.getCtrl("BtnDel3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideNo").val(),c=g.getCtrl("HoldingWeightOutSideFund2").val();return null===b||void 0===b||null===c||void 0===c?void jCom.Alert("提醒","請選一個公司名稱!!"):void g.callDataBus("BackHoldingWeightOutSide/DelFund2",{HoldingWeightOutSideNo:b,Num:c,LogSN:g.getCtrl("LogSN3").val()})}),g.getCtrl("BtnFlow").on("click",function(a){$(this);a.preventDefault();var b=g.getCtrl("HoldingWeightOutSideFund").val();if(console.log(b),null===b||void 0===b)return void jCom.Alert("提醒","請輸入一筆公司!!");var c=g.getCtrl("NextFlow").val().split("@@"),d={};return d.HoldingWeightOutSideNo=g.getCtrl("HoldingWeightOutSideNo").val(),d.NextType=c[0],d.NextStatus=c[1],d.Note="",d.EndDate=g.getCtrl("EndDate").val(),d.LogSN=g.getCtrl("LogSN").val(),"1"===c[0]&&""===g.getCtrl("EndDate").val()?void jCom.Alert("提醒","下架日必須填"):void g.callDataBus("BackHoldingWeightOutSide/NextFlow",d)})});