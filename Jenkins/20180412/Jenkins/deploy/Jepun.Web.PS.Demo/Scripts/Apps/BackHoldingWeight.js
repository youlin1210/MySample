/*! jepun 2018-03-29 */
$(document).ready(function(){function a(a,c,d,e,f){var h={};h.url=jCom.urlPath("BackHoldingWeight/GetHoldingWeightAllT0"),h.reload=!0,h.QryStartDate=a,h.QryEndDate=c,h.QryType=d,h.QryStatus=e,h.HoldingWeightNo=f,$.when(g.addSelect("HoldingWeightNo",h)).then(function(){""!==GlbEnv.args.upcoming&&(g.getCtrl("HoldingWeightNo").filterSelect("-1",!0),$("#"+GlbEnv.args.upcoming+"Count").html(g.getCtrl("HoldingWeightNo").find("option").length)),0===f?g.getCtrl("HoldingWeightNo")[0].selectedIndex=0:g.getCtrl("HoldingWeightNo").val(f),b(g.getCtrl("HoldingWeightNo").val())})}function b(a){g.getCtrl("BtnIns2,BtnUpd2,BtnDel2,BtnIns3,BtnUpd3,BtnDel3,BtnUpd,BtnDel,BtnCopy,NextFlow,BtnFlow").addClass("hidden"),null!==a&&void 0!==a&&(g.callDataBus("BackHoldingWeight/GetHoldingWeightT1",{HoldingWeightNo:a}),c(a,0),e(a,0))}function c(a,b){var c={};c.url=jCom.urlPath("BackHoldingWeight/GetHoldingWeightFundAllT3"),c.HoldingWeightNo=a,c.Num=b,c.reload=!0,$.when(g.addSelect("HoldingWeightFund",c)).then(function(){0===b?g.getCtrl("HoldingWeightFund")[0].selectedIndex=0:g.getCtrl("HoldingWeightFund").val(b),d(g.getCtrl("HoldingWeightNo").val(),g.getCtrl("HoldingWeightFund").val())})}function d(a,b){null!==a&&void 0!==a&&null!==b&&void 0!==b&&g.callDataBus("BackHoldingWeight/GetHoldingWeightFundT4",{HoldingWeightNo:a,Num:b})}function e(a,b){var c={};c.url=jCom.urlPath("BackHoldingWeight/GetHoldingWeightFundAllT5"),c.HoldingWeightNo=a,c.Num=b,c.reload=!0,$.when(g.addSelect("HoldingWeightFund2",c)).then(function(){0===b?g.getCtrl("HoldingWeightFund2")[0].selectedIndex=0:g.getCtrl("HoldingWeightFund2").val(b),f(g.getCtrl("HoldingWeightNo").val(),g.getCtrl("HoldingWeightFund2").val())})}function f(a,b){null!==a&&void 0!==a&&null!==b&&void 0!==b&&g.callDataBus("BackHoldingWeight/GetHoldingWeightFundT6",{HoldingWeightNo:a,Num:b})}var g=$("#FormBackHoldingWeight").comm();g.addHandler("Ini",function(b){jFun.client.isMobile?g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").prop("type","date"):(g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").prop("type","text").addClass("dpDate"),g.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate").datepicker({dateFormat:"yy/mm/dd",firstDay:0,changeYear:!0,changeMonth:!0,yearRange:"1900:2030"})),$.when(g.addSelect("QryStatus",jFun.getOptionsUrl("Status",1,"",!1)),g.addSelect("QryType",jFun.getOptionsUrl("Type",1,"",!1)),g.addSelect("Fund",jFun.getProductFundOptionsT3()),g.addSelect("IndType,IndType2",jFun.getOptionsUrl("IndType",1,""))).then(function(){g.getCtrl("QryStatus")[0].selectedIndex=1,""!==GlbEnv.args.upcoming?(g.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)})}),g.addHandler("BtnCopy",function(b){a(null,null,null,null,b.HoldingWeightNo)}),g.addHandler("BtnIns",function(b){a(null,null,null,null,b.HoldingWeightNo)}),g.addHandler("BtnUpd",function(b){a(null,null,null,null,g.getCtrl("HoldingWeightNo").val())}),g.addHandler("BtnDel",function(b){a(null,null,null,null,0)}),g.addHandler("BtnInsFund",function(a){c(g.getCtrl("HoldingWeightNo").val(),a.Num)}),g.addHandler("BtnUpdFund",function(a){c(g.getCtrl("HoldingWeightNo").val(),a.Num)}),g.addHandler("BtnDelFund",function(a){c(g.getCtrl("HoldingWeightNo").val(),0)}),g.addHandler("BtnInsFund2",function(a){e(g.getCtrl("HoldingWeightNo").val(),a.Num)}),g.addHandler("BtnUpdFund2",function(a){e(g.getCtrl("HoldingWeightNo").val(),a.Num)}),g.addHandler("BtnDelFund2",function(a){e(g.getCtrl("HoldingWeightNo").val(),0)}),g.addHandler("GetHoldingWeightT1",function(a){""!==GlbEnv.args.upcoming?$.when(initButton(g,a.obj,"HoldingWeightNo")).then(function(){g.getCtrl("BtnCopy").hide()}):initButton(g,a.obj,"HoldingWeightNo")}),g.addHandler("GetHoldingWeightFundT4",function(a){var b=$.parseJSON(a.obj);b.length>0&&g.formInject(b[0])}),g.addHandler("GetHoldingWeightFundT6",function(a){var b=$.parseJSON(a.obj);b.length>0&&g.formInject(b[0])}),g.addHandler("NextFlow",function(b){""!==GlbEnv.args.upcoming?(g.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)}),g.getCtrl("HoldingWeightNo").on("click",function(a){a.preventDefault();var c=$(this);b(c.val()),g.getCtrl("IndType,IndType2").val("-1"),g.getCtrl("Name").val(""),g.getCtrl("Weight,Weight2").val("0")}),g.getCtrl("QryFlow").on("click",function(a){a.preventDefault(),GlbAppModal.openModal("歷史流程","BackFlowDetail",{Type:19,Rno:g.getCtrl("HoldingWeightNo").val()})}),g.getCtrl("HoldingWeightFund").on("click",function(a){a.preventDefault();var b=$(this),c=g.getCtrl("HoldingWeightNo").val();d(c,b.val())}),g.getCtrl("HoldingWeightFund2").on("click",function(a){a.preventDefault();var b=$(this),c=g.getCtrl("HoldingWeightNo").val();f(c,b.val())}),g.getCtrl("BtnCopy").on("click",function(a){if(a.preventDefault(),g.valid()){var b=g.getCtrl("Fund").val(),c=b.split("@@")[0],d=b.split("@@")[1];g.getCtrl("CID").val(c),g.getCtrl("FID").val(d),g.callDataBus("BackHoldingWeight/Copy",g.formToJSON())}}),g.getCtrl("BtnIns").on("click",function(a){if(a.preventDefault(),g.valid()){var b=g.getCtrl("Fund").val(),c=b.split("@@")[0],d=b.split("@@")[1];g.getCtrl("CID").val(c),g.getCtrl("FID").val(d),g.callDataBus("BackHoldingWeight/Ins",g.formToJSON())}}),g.getCtrl("BtnUpd").on("click",function(a){a.preventDefault();var b=g.formBeforeJSON(),c=g.getCtrl("Fund").val(),d=c.split("@@")[0],e=c.split("@@")[1];g.getCtrl("CID").val(d),g.getCtrl("FID").val(e),g.callDataBus("BackHoldingWeight/Upd",{model:g.formToJSON(b,!1),Oldmodel:g.formBeforeJSON()})}),g.getCtrl("BtnDel").on("click",function(a){a.preventDefault(),console.log(1),g.callDataBus("BackHoldingWeight/Del",{HoldingWeightNo:g.getCtrl("HoldingWeightNo").val(),NextType:"0",NextStatus:"7",Note:"",LogSN:g.getCtrl("LogSN").val()})}),g.getCtrl("BtnQry").on("click",function(b){b.preventDefault();var c=g.getCtrl("QryStartDate").val(),d=g.getCtrl("QryEndDate").val(),e=g.getCtrl("QryType").val(),f=g.getCtrl("QryStatus").val();a(c,d,e,f,0),g.getCtrl("HoldingWeightFund").html("")}),g.getCtrl("BtnIns2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightNo").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個基金!!"):null===g.getCtrl("Name,Weight").val()||void 0===g.getCtrl("Name,Weight").val()||"-1"===g.getCtrl("IndType").val()?void jCom.Alert("提醒","請輸入有效的值"):void g.callDataBus("BackHoldingWeight/InsFund",g.formToJSON())}),g.getCtrl("BtnUpd2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightFund").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個據點!!"):void g.callDataBus("BackHoldingWeight/UpdFund",g.formToJSON())}),g.getCtrl("BtnDel2").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightNo").val(),c=g.getCtrl("HoldingWeightFund").val();return null===b||void 0===b||null===c||void 0===c?void jCom.Alert("提醒","請選一個公司名稱!!"):void g.callDataBus("BackHoldingWeight/DelFund",{HoldingWeightNo:b,Num:c,LogSN:g.getCtrl("LogSN2").val()})}),g.getCtrl("BtnIns3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightNo").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個基金!!"):null===g.getCtrl("Weight2").val()||void 0===g.getCtrl("Weight2").val()||"-1"===g.getCtrl("IndType2").val()?void jCom.Alert("提醒","請輸入有效的值"):void g.callDataBus("BackHoldingWeight/InsFund2",g.formToJSON())}),g.getCtrl("BtnUpd3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightFund2").val();return null===b||void 0===b?void jCom.Alert("提醒","請選一個資產!!"):void g.callDataBus("BackHoldingWeight/UpdFund2",g.formToJSON())}),g.getCtrl("BtnDel3").on("click",function(a){a.preventDefault();var b=g.getCtrl("HoldingWeightNo").val(),c=g.getCtrl("HoldingWeightFund2").val();return null===b||void 0===b||null===c||void 0===c?void jCom.Alert("提醒","請選一個資產!!"):void g.callDataBus("BackHoldingWeight/DelFund2",{HoldingWeightNo:b,Num:c,LogSN:g.getCtrl("LogSN3").val()})}),g.getCtrl("BtnFlow").on("click",function(a){$(this);a.preventDefault();var b=g.getCtrl("HoldingWeightFund").val();if(console.log(b),null===b||void 0===b)return void jCom.Alert("提醒","請輸入一筆公司!!");var c=g.getCtrl("NextFlow").val().split("@@"),d={};return d.HoldingWeightNo=g.getCtrl("HoldingWeightNo").val(),d.NextType=c[0],d.NextStatus=c[1],d.Note="",d.EndDate=g.getCtrl("EndDate").val(),d.LogSN=g.getCtrl("LogSN").val(),"1"===c[0]&&""===g.getCtrl("EndDate").val()?void jCom.Alert("提醒","下架日必須填"):void g.callDataBus("BackHoldingWeight/NextFlow",d)})});