/*! jepun 2018-03-29 */
$(document).ready(function(){function a(a,d,e){var f={};f.url=jCom.urlPath("BackOption/GetOptions"),f.reload=!0,f.Type=a,f.QueryKey=d,f.Code=e,$.when(c.addSelect("OptionList",f)).then(function(){null===e||void 0===e?c.getCtrl("OptionList")[0].selectedIndex=0:c.getCtrl("OptionList").val(e),b(d,e)})}function b(a,b){c.getCtrl("BtnIns,BtnUpd,BtnDel").addClass("hidden"),null!==a&&void 0!==a&&c.callDataBus("BackOption/GetOption",{QueryKey:a,Code:b})}var c=$("#FormBackOption").comm();c.addHandler("Ini",function(a){c.getCtrl("BtnIns,BtnUpd,BtnDel,BtnBack").addClass("hidden"),c.addSelect("Option",jFun.getOptionsUrl("",4)),c.addSelect("Ex2",jFun.getOptionsUrl("FundKind",1))}),c.addHandler("InsOptions",function(b){a(5,c.getCtrl("Option").val(),b.Code)}),c.addHandler("UpdOptions",function(b){a(5,c.getCtrl("Option").val(),b.Code)}),c.addHandler("DelOptions",function(b){a(5,c.getCtrl("Option").val(),null)}),c.addHandler("GetOption",function(a){var b=$.parseJSON(a.obj);b.length>0&&$.when(c.formInject(b[0])).then(function(){"-1"===c.getCtrl("OptionList").val()?(c.getCtrl("BtnIns").removeClass("hidden"),c.setVal("Order","")):(c.getCtrl("BtnUpd,BtnDel").removeClass("hidden"),c.valid())})}),c.addHandler("GetColView",function(a){c.setHtml("colView",a.obj)}),c.getCtrl("Option").on("click",function(b){b.preventDefault();var d=$(this);return"-1"===d.val()?(c.getCtrl("OptionList").empty(),c.getCtrl("BtnIns").addClass("hidden"),void c.getCtrl("CodeShow,ExShow").hide()):("Agent"===d.val()?c.getCtrl("CodeShow").show():"CNO"===d.val()?c.getCtrl("CodeShow").show():c.getCtrl("CodeShow").hide(),"CNO"===d.val()?c.getCtrl("ExShow").show():c.getCtrl("ExShow").hide(),"IndType"===d.val()||"IndCurType"===d.val()?c.getCtrl("ColShow").show():c.getCtrl("ColShow").hide(),c.getCtrl("QueryKey").val(d.val()),void a(5,d.val(),null))}),c.getCtrl("OptionList").on("click",function(a){a.preventDefault();var d=$(this),e=c.getCtrl("Option").val();b(e,d.val())}),c.getCtrl("BtnIns").on("click",function(a){a.preventDefault();var b=c.getCtrl("Option").val();null!==b&&void 0!==b&&c.valid()&&c.formXhrDataBus("BackOption/InsOptions")}),c.getCtrl("BtnUpd").on("click",function(a){a.preventDefault();var b=c.getCtrl("OptionList").val();if(null===b||void 0===b)return void jCom.Alert("","請選擇一個選項");var d=c.formBeforeJSON();c.callDataBus("BackOption/UpdOptions",{model:c.formToJSON(d,!1),Oldmodel:c.formBeforeJSON()})}),c.getCtrl("BtnDel").on("click",function(a){a.preventDefault();var b=c.getCtrl("Option").val(),d=c.getCtrl("OptionList").val(),e=c.getCtrl("LogSN").val();return null===d||void 0===d?void jCom.Alert("","請選擇一個選項"):void c.callDataBus("BackOption/DelOptions",{QueryKey:b,Code:d,LogSN:e})})});