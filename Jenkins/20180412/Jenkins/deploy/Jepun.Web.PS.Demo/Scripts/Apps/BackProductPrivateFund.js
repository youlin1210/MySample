/*! jepun 2018-03-29 */
$(document).ready(function(){function a(a,c,d,f,g){var h={};h.url=jCom.urlPath("BackProductPrivateFund/GetProductPrivateFunds"),h.reload=!0,h.QryStartDate=a,h.QryEndDate=c,h.QryType=d,h.QryStatus=f,h.ProductPrivateFundNo=g,$.when(e.addSelect("ProductPrivateFundNo",h)).then(function(){""!==GlbEnv.args.upcoming&&(e.getCtrl("ProductPrivateFundNo").filterSelect("-1",!0),$("#"+GlbEnv.args.upcoming+"Count").html(e.getCtrl("ProductPrivateFundNo").find("option").length)),0===g?e.getCtrl("ProductPrivateFundNo")[0].selectedIndex=0:e.getCtrl("ProductPrivateFundNo")[0].selectedIndex=1,b(e.getCtrl("ProductPrivateFundNo").val())})}function b(a){e.getCtrl("BtnUpd,BtnDel,BtnInsFile1,BtnInsFile2,BtnInsFile3,BtnDelFile1,BtnDelFile2,BtnDelFile3,InputFile_1,InputFile_2,InputFile_3,NextFlow,BtnFlow").addClass("hidden"),null!==a&&void 0!==a&&$.when(e.callDataBus("BackProductPrivateFund/GetProductPrivateFund",{ProductPrivateFundNo:a})).then(function(){c(a,0)})}function c(a,b){$.when(e.addSelect("ProductPrivateFundFile1",d(a,1)),e.addSelect("ProductPrivateFundFile2",d(a,2)),e.addSelect("ProductPrivateFundFile3",d(a,3))).then(function(){e.getCtrl("InputFile_1").val(""),e.getCtrl("InputFile_2").val(""),e.getCtrl("InputFile_3").val("")})}function d(a,b){var c={};return c.url=jCom.urlPath("BackProductPrivateFund/GetProductPrivateFundFiles"),c.reload=!0,c.ProductPrivateFundNo=a,c.fileKind=b,c}var e=$("#FormBackProductPrivateFund").comm();e.addHandler("Ini",function(b){jFun.client.isMobile?e.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate,EstablishDate").prop("type","date"):(e.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate,EstablishDate").prop("type","text").addClass("dpDate"),e.getCtrl("StartDate,EndDate,QryStartDate,QryEndDate,EstablishDate").datepicker({dateFormat:"yy/mm/dd",firstDay:0,changeYear:!0,changeMonth:!0,yearRange:"1900:2030"})),e.addSelect("RiskLv",jFun.getOptionsUrl("RiskLvKind",1)),e.addSelect("FundType",jFun.getOptionsUrl("FundKind",1)),e.addSelect("QryType",jFun.getOptionsUrl("Type",1,"",!1)),$.when(e.addSelect("QryStatus",jFun.getOptionsUrl("Status",1,"",!1))).then(function(){e.getCtrl("QryStatus")[0].selectedIndex=1}),""!==GlbEnv.args.upcoming?(e.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)}),e.addHandler("BtnIns",function(b){a(null,null,null,null,b.ProductPrivateFundNo)}),e.addHandler("BtnUpd",function(b){a(null,null,null,null,e.getCtrl("ProductPrivateFundNo").val())}),e.addHandler("BtnDel",function(b){a(null,null,null,null,0)}),e.addHandler("DelFile",function(a){c(e.getCtrl("ProductPrivateFundNo").val(),a.Key)}),e.addHandler("GetProductPrivateFund",function(a){initButton(e,a.obj,"ProductPrivateFundNo")}),e.addHandler("NextFlow",function(b){""!==GlbEnv.args.upcoming?(e.find(".jepun-upcoming").hide(),"Manager"===b.role?a(null,null,null,"1",0):a(null,null,null,"2",0)):a(null,null,null,"99",0)}),e.getCtrl("ProductPrivateFundNo").on("click",function(a){a.preventDefault();var c=$(this);b(c.val())}),e.getCtrl("QryFlow").on("click",function(a){a.preventDefault(),GlbAppModal.openModal("歷史流程","BackFlowDetail",{Type:7,Rno:e.getCtrl("ProductPrivateFundNo").val()})}),e.getCtrl("BtnIns").on("click",function(a){a.preventDefault(),e.valid()&&e.formXhrDataBus("BackProductPrivateFund/Ins")}),e.getCtrl("BtnUpd").on("click",function(a){a.preventDefault();var b=e.formBeforeJSON();e.callDataBus("BackProductPrivateFund/Upd",{model:e.formToJSON(b,!1),Oldmodel:e.formBeforeJSON()})}),e.getCtrl("BtnDel").on("click",function(a){a.preventDefault(),e.callDataBus("BackProductPrivateFund/Del",{ProductPrivateFundNo:e.getCtrl("ProductPrivateFundNo").val(),NextType:"0",NextStatus:"7",Note:"",LogSN:e.getCtrl("LogSN").val()})}),e.getCtrl("BtnQry").on("click",function(b){b.preventDefault();var c=e.getCtrl("QryStartDate").val(),d=e.getCtrl("QryEndDate").val(),f=e.getCtrl("QryType").val(),g=e.getCtrl("QryStatus").val();a(c,d,f,g,0)}),e.getCtrl("BtnInsFile1,BtnInsFile2,BtnInsFile3").on("click",function(a){a.preventDefault();var b=$(this),d=b.getKeyVal(),f=e.getCtrl("InputFile_"+d).val();if(""===f)return void jCom.Alert("提醒","請選擇檔案!!");var g=e.getCtrl("ProductPrivateFundNo").val();e.getCtrl("FileKind").val(e.getCtrl("InputFile_"+d).attr("name"));return null===g||void 0===g?void jCom.Alert("提醒","請選一筆私募基金!!"):void e.formXhrDataBus("BackProductPrivateFund/Upload",function(){c(e.getCtrl("ProductPrivateFundNo").val(),d)})}),e.getCtrl("BtnDelFile1,BtnDelFile2,BtnDelFile3").on("click",function(a){a.preventDefault();var b=$(this),c=b.getKeyVal(),d=e.getCtrl("ProductPrivateFundFile"+c).val();return null===d||void 0===d?void jCom.Alert("提醒","請選一筆檔案!!"):(d=d.split("@@"),void e.callDataBus("BackProductPrivateFund/DelFile",{ProductPrivateFundNo:d[0],Num:d[1],LogSN:d[2],FileKind:d[3]}))}),e.getCtrl("ProductPrivateFundFile1,ProductPrivateFundFile2,ProductPrivateFundFile3").on("click",function(a){a.preventDefault();var b=$(this),c=b.val();if(null!==c){var d=c.split("@@"),e=$("#DefTargetForm").comm();e.formTarget("BackProductPrivateFund/Download","{'ProductPrivateFundNo':'"+d[0]+"','Num':'"+d[1]+"','FileKind':'"+d[3]+"'}")}}),e.getCtrl("BtnFlow").on("click",function(a){$(this);a.preventDefault();var b=e.getCtrl("ProductPrivateFundFile1").val(),c=e.getCtrl("ProductPrivateFundFile2").val(),d=e.getCtrl("ProductPrivateFundFile3").val();if(null===b||void 0===b)return void jCom.Alert("提醒","請選擇一筆投資月報!!");if(null===c||void 0===c)return void jCom.Alert("提醒","請選擇一筆簡式公開說明書!!");if(null===d||void 0===d)return void jCom.Alert("提醒","請選擇一筆公開說明書!!");var f=e.getCtrl("NextFlow").val().split("@@"),g={};return g.ProductPrivateFundNo=e.getCtrl("ProductPrivateFundNo").val(),g.NextType=f[0],g.NextStatus=f[1],g.Note="",g.EndDate=e.getCtrl("EndDate").val(),g.LogSN=e.getCtrl("LogSN").val(),"1"===f[0]&&""===e.getCtrl("EndDate").val()?void jCom.Alert("提醒","下架日必須填"):void e.callDataBus("BackProductPrivateFund/NextFlow",g)})});