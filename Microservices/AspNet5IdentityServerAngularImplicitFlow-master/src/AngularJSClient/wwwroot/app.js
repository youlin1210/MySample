!function(){var a=angular.module("mainApp",["ui.router","LocalStorageModule"]);a.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/unauthorized"),a.state("authorized",{url:"/authorized",templateUrl:"/templates/authorized.html",controller:"AuthorizeController"}).state("forbidden",{url:"/forbidden",templateUrl:"/templates/forbidden.html"}).state("unauthorized",{url:"/unauthorized",templateUrl:"/templates/unauthorized.html"}).state("logoff",{url:"/logoff",templateUrl:"/templates/unauthorized.html",controller:"LogoffController"}).state("details",{url:"/details/:id",templateUrl:"/templates/details.html",controller:"DetailsController",resolve:{DataEventRecordsService:"DataEventRecordsService",dataEventRecord:["DataEventRecordsService","$stateParams",function(a,b){var c=b.id;return console.log(b.id),a.GetDataEventRecord({id:c})}]}}).state("overviewindex",{url:"/overviewindex",templateUrl:"/templates/overviewindex.html",controller:"OverviewController",resolve:{DataEventRecordsService:"DataEventRecordsService",dataEventRecords:["DataEventRecordsService",function(a){return a.GetDataEventRecords()}]}}).state("create",{url:"/create",templateUrl:"/templates/create.html",controller:"DetailsController",resolve:{dataEventRecord:[function(){return{Id:"",Name:"",Description:"",Timestamp:"2016-02-15T08:57:32"}}]}}).state("reload",{url:"/reload/:destinationState",controller:["$state","$stateParams",function(a,b){b.destinationState?a.go(b.destinationState):a.go("overviewindex")}]}),c.html5Mode(!0)}]),a.run(["$rootScope",function(a){a.$on("$stateChangeError",function(a,b,c,d,e,f){console.log(a),console.log(b),console.log(c),console.log(d),console.log(e),console.log(f)}),a.$on("$stateNotFound",function(a,b,c,d){console.log(a),console.log(b),console.log(c),console.log(d)})}])}(),function(){"use strict";function a(a,b,c){a.info("AuthorizeController called"),b.message="AuthorizeController created",c.DoAuthorization()}var b=angular.module("mainApp");b.controller("AuthorizeController",["$log","$scope","SecurityService",a])}(),function(){"use strict";function a(a,b,c,d,e){b.info("DetailsController called"),a.message="dataEventRecord Create, Update or Delete",a.DataEventRecordsService=d,a.state=e,a.dataEventRecord=c,a.Update=function(){b.info("Updating"),b.info(c),a.DataEventRecordsService.UpdateDataEventRecord(c).then(function(){a.state.go("reload",{destinationState:"overviewindex"})})},a.Create=function(){b.info("Creating"),b.info(c),a.DataEventRecordsService.AddDataEventRecord(c).then(function(){a.state.go("reload",{destinationState:"overviewindex"})})}}var b=angular.module("mainApp");b.controller("DetailsController",["$scope","$log","dataEventRecord","DataEventRecordsService","$state",a])}(),function(){"use strict";function a(a,b,c){a.info("LogoffController called"),b.message="LogoffController created",alert("called Logoff"),c.Logoff()}var b=angular.module("mainApp");b.controller("LogoffController",["$log","$scope","SecurityService",a])}(),function(){"use strict";function a(a,b,c,d,e){b.info("OverviewController called"),a.message="Overview",a.DataEventRecordsService=d,b.info(c),a.dataEventRecords=c,a.Delete=function(c){b.info("deleting"),a.DataEventRecordsService.DeleteDataEventRecord(c).then(function(){e.go(e.current,{},{reload:!0})})}}var b=angular.module("mainApp");b.controller("OverviewController",["$scope","$log","dataEventRecords","DataEventRecordsService","$state",a])}(),function(){"use strict";function a(a,b){console.log("AuthorizationInterceptor created");var c=function(c){return c.headers=c.headers||{},""!==b.get("authorizationData")&&(c.headers.Authorization="Bearer "+b.get("authorizationData")),c||a.when(c)},d=function(a){return console.log("console.log(responseFailure);"),console.log(a),403===a.status?(alert("forbidden"),window.location="https://localhost:44347/forbidden",window.href="forbidden"):401===a.status&&(alert("unauthorized"),b.set("authorizationData","")),this.q.reject(a)};return{request:c,responseError:d}}var b=angular.module("mainApp");b.service("authorizationInterceptor",["$q","localStorageService",a]),b.config(["$httpProvider",function(a){a.interceptors.push("authorizationInterceptor")}])}(),function(){"use strict";function a(a,b,c,d){b.info("DataEventRecordsService called");var e="https://localhost:44390/",f=function(b){var d=c.defer();return console.log("addDataEventRecord started"),console.log(b),a({url:e+"api/DataEventRecords",method:"POST",data:b}).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},g=function(b){var d=c.defer();return console.log("addDataEventRecord started"),console.log(b),a({url:e+"api/DataEventRecords/"+b.Id,method:"PUT",data:b}).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},h=function(b){var d=c.defer();return console.log("DeleteDataEventRecord begin"),console.log(b),a({url:e+"api/DataEventRecords/"+b,method:"DELETE",data:""}).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},i=function(){var b=c.defer();return console.log("GetDataEventRecords started"),console.log(d.authorizationData),a({url:e+"api/DataEventRecords",method:"GET"}).success(function(a){console.log("GetDataEventRecords success"),b.resolve(a)}).error(function(a){console.log("GetDataEventRecords error"),b.reject(a)}),b.promise},j=function(d){b.info("DataEventRecordService GetDataEventRecord called: "+d.id),b.info(d);var f=c.defer();return a({url:e+"api/DataEventRecords/"+d.id,method:"GET"}).success(function(a){console.log("GetDataEventRecords success"),f.resolve(a)}).error(function(a){console.log("GetDataEventRecords error"),f.reject(a)}),f.promise};return{AddDataEventRecord:f,UpdateDataEventRecord:g,DeleteDataEventRecord:h,GetDataEventRecords:i,GetDataEventRecord:j}}var b=angular.module("mainApp");b.factory("DataEventRecordsService",["$http","$log","$q","$rootScope",a])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)}function i(a){var b={};if("undefined"!=typeof a){var c=a.split(".")[1];b=JSON.parse(h(c))}return b}b.info("SecurityService called"),d.IsAuthorized=!1,d.HasAdminRole=!1;var j=function(){g.set("authorizationData",""),g.set("authorizationDataIdToken",""),d.IsAuthorized=!1,d.HasAdminRole=!1},k=function(a,b){""!==g.get("authorizationData")&&g.set("authorizationData",""),g.set("authorizationData",a),g.set("authorizationDataIdToken",b),d.IsAuthorized=!0;for(var c=i(a),e=0;e<c.role.length;e++)"dataEventRecords.admin"===c.role[e]&&(d.HasAdminRole=!0)},l=function(){console.log("AuthorizedController time to log on");var a="https://localhost:44318/connect/authorize",b="angularjsclient",c="https://localhost:44376/authorized",d="id_token token",f="dataEventRecords securedFiles openid",h="N"+Math.random()+Date.now(),i=Date.now()+""+Math.random();g.set("authNonce",h),g.set("authStateControl",i),console.log("AuthorizedController created. adding myautostate: "+g.get("authStateControl"));var j=a+"?response_type="+encodeURI(d)+"&client_id="+encodeURI(b)+"&redirect_uri="+encodeURI(c)+"&scope="+encodeURI(f)+"&nonce="+encodeURI(h)+"&state="+encodeURI(i);e.location=j},m=function(){console.log("AuthorizedController created, has hash");var a=window.location.hash.substr(1),b=a.split("&").reduce(function(a,b){var c=b.split("=");return a[c[0]]=c[1],a},{}),c="",d="",e=!1;if(!b.error)if(b.state!==g.get("authStateControl"))console.log("AuthorizedCallback incorrect state");else{c=b.access_token,d=b.id_token;var h=i(d);console.log(h),h.nonce!==g.get("authNonce")?console.log("AuthorizedCallback incorrect nonce"):(g.set("authNonce",""),g.set("authStateControl",""),e=!0,console.log("AuthorizedCallback state and nonce validated, returning access token"))}e?(k(c,d),console.log(g.get("authorizationData")),f.go("overviewindex")):(j(),f.go("unauthorized"))},n=function(){j(),e.location.hash?m():l()},o=function(){j(),e.location="https://localhost:44346/unauthorized.html"};return{ResetAuthorizationData:j,SetAuthorizationData:k,DoAuthorization:n,Logoff:o}}var b=angular.module("mainApp");b.factory("SecurityService",["$http","$log","$q","$rootScope","$window","$state","localStorageService",a])}();